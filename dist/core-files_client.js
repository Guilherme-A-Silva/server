(()=>{"use strict";var e,t,s,r,i={64706:function(e,t,s){var r,i,n,o=s(22696);r=OC,i=OC.Files.FileInfo,(n=function(e){this._root=e.root,"/"===this._root.charAt(this._root.length-1)&&(this._root=this._root.substr(0,this._root.length-1));let t=n.PROTOCOL_HTTP+"://";e.useHTTPS&&(t=n.PROTOCOL_HTTPS+"://"),t+=e.host+this._root,this._host=e.host,this._defaultHeaders=e.defaultHeaders||{"X-Requested-With":"XMLHttpRequest",requesttoken:r.requestToken},this._baseUrl=t;let s={baseUrl:this._baseUrl,xmlNamespaces:{"DAV:":"d","http://owncloud.org/ns":"oc","http://nextcloud.org/ns":"nc","http://open-collaboration-services.org/ns":"ocs"}};e.userName&&(s.userName=e.userName),e.password&&(s.password=e.password),this._client=new dav.Client(s),this._client.xhrProvider=_.bind(this._xhrProvider,this),this._fileInfoParsers=[]}).NS_OWNCLOUD="http://owncloud.org/ns",n.NS_NEXTCLOUD="http://nextcloud.org/ns",n.NS_DAV="DAV:",n.NS_OCS="http://open-collaboration-services.org/ns",n.PROPERTY_GETLASTMODIFIED="{"+n.NS_DAV+"}getlastmodified",n.PROPERTY_GETETAG="{"+n.NS_DAV+"}getetag",n.PROPERTY_GETCONTENTTYPE="{"+n.NS_DAV+"}getcontenttype",n.PROPERTY_RESOURCETYPE="{"+n.NS_DAV+"}resourcetype",n.PROPERTY_INTERNAL_FILEID="{"+n.NS_OWNCLOUD+"}fileid",n.PROPERTY_PERMISSIONS="{"+n.NS_OWNCLOUD+"}permissions",n.PROPERTY_SIZE="{"+n.NS_OWNCLOUD+"}size",n.PROPERTY_GETCONTENTLENGTH="{"+n.NS_DAV+"}getcontentlength",n.PROPERTY_ISENCRYPTED="{"+n.NS_DAV+"}is-encrypted",n.PROPERTY_SHARE_PERMISSIONS="{"+n.NS_OCS+"}share-permissions",n.PROPERTY_SHARE_ATTRIBUTES="{"+n.NS_NEXTCLOUD+"}share-attributes",n.PROPERTY_QUOTA_AVAILABLE_BYTES="{"+n.NS_DAV+"}quota-available-bytes",n.PROTOCOL_HTTP="http",n.PROTOCOL_HTTPS="https",n._PROPFIND_PROPERTIES=[[n.NS_DAV,"getlastmodified"],[n.NS_DAV,"getetag"],[n.NS_DAV,"getcontenttype"],[n.NS_DAV,"resourcetype"],[n.NS_OWNCLOUD,"fileid"],[n.NS_OWNCLOUD,"permissions"],[n.NS_OWNCLOUD,"size"],[n.NS_DAV,"getcontentlength"],[n.NS_DAV,"quota-available-bytes"],[n.NS_NEXTCLOUD,"has-preview"],[n.NS_NEXTCLOUD,"mount-type"],[n.NS_NEXTCLOUD,"is-encrypted"],[n.NS_OCS,"share-permissions"],[n.NS_NEXTCLOUD,"share-attributes"]],n.prototype={_root:null,_client:null,_fileInfoParsers:[],_xhrProvider:function(){let e=this._defaultHeaders,t=new XMLHttpRequest,s=t.open;return t.open=function(){let r=s.apply(this,arguments);return _.each(e,function(e,s){t.setRequestHeader(s,e)}),r},r.registerXHRForErrorProcessing(t),t},_buildUrl:function(){let e=this._buildPath.apply(this,arguments);return"/"===e.charAt([e.length-1])&&(e=e.substr(0,e.length-1)),"/"===e.charAt(0)&&(e=e.substr(1)),this._baseUrl+"/"+e},_buildPath:function(){let e,t=r.joinPaths.apply(this,arguments),s=t.split("/");for(e=0;e<s.length;e++)s[e]=encodeURIComponent(s[e]);return s.join("/")},_parseHeaders:function(e){let t=e.split("\n"),s={};for(let e=0;e<t.length;e++){let r=t[e].indexOf(":");if(r<0)continue;let i=t[e].substr(0,r),n=t[e].substr(r+2);s[i]||(s[i]=[]),s[i].push(n)}return s},_parseEtag:function(e){return'"'===e.charAt(0)?e.split('"')[1]:e},_parseFileInfo:function(e){let t=decodeURIComponent(e.href);if(t.substr(0,this._root.length)===this._root&&(t=t.substr(this._root.length)),"/"===t.charAt(t.length-1)&&(t=t.substr(0,t.length-1)),0===e.propStat.length||"HTTP/1.1 200 OK"!==e.propStat[0].status)return null;let s=e.propStat[0].properties,o={id:s[n.PROPERTY_INTERNAL_FILEID],path:r.dirname(t)||"/",name:r.basename(t),mtime:new Date(s[n.PROPERTY_GETLASTMODIFIED]).getTime()},a=s[n.PROPERTY_GETETAG];_.isUndefined(a)||(o.etag=this._parseEtag(a));let l=s[n.PROPERTY_GETCONTENTLENGTH];_.isUndefined(l)||(o.size=parseInt(l,10)),l=s[n.PROPERTY_SIZE],_.isUndefined(l)||(o.size=parseInt(l,10));let u=s["{"+n.NS_NEXTCLOUD+"}has-preview"];_.isUndefined(u)?o.hasPreview=!0:o.hasPreview="true"===u;let c=s["{"+n.NS_NEXTCLOUD+"}is-encrypted"];_.isUndefined(c)?o.isEncrypted=!1:o.isEncrypted="1"===c;let p=s["{"+n.NS_OWNCLOUD+"}favorite"];_.isUndefined(p)?o.isFavourited=!1:o.isFavourited="1"===p;let h=s[n.PROPERTY_GETCONTENTTYPE];_.isUndefined(h)||(o.mimetype=h);let d=s[n.PROPERTY_RESOURCETYPE];if(!o.mimetype&&d){let e=d[0];e.namespaceURI===n.NS_DAV&&"collection"===e.nodeName.split(":")[1]&&(o.mimetype="httpd/unix-directory")}o.permissions=r.PERMISSION_NONE;let f=s[n.PROPERTY_PERMISSIONS];if(!_.isUndefined(f)){let e=f||"";o.mountType=null;for(let t=0;t<e.length;t++)switch(e.charAt(t)){case"C":case"K":o.permissions|=r.PERMISSION_CREATE;break;case"G":o.permissions|=r.PERMISSION_READ;break;case"W":case"N":case"V":o.permissions|=r.PERMISSION_UPDATE;break;case"D":o.permissions|=r.PERMISSION_DELETE;break;case"R":o.permissions|=r.PERMISSION_SHARE;break;case"M":o.mountType||(o.mountType="external");break;case"S":o.mountType="shared"}}let S=s[n.PROPERTY_SHARE_PERMISSIONS];_.isUndefined(S)||(o.sharePermissions=parseInt(S));let E=s[n.PROPERTY_SHARE_ATTRIBUTES];if(_.isUndefined(E))o.shareAttributes=[];else try{o.shareAttributes=JSON.parse(E)}catch(e){console.warn('Could not parse share attributes returned by server: "'+E+'"'),o.shareAttributes=[]}let P=s["{"+n.NS_NEXTCLOUD+"}mount-type"];_.isUndefined(P)||(o.mountType=P);let T=s["{"+n.NS_DAV+"}quota-available-bytes"];return _.isUndefined(T)||(o.quotaAvailableBytes=T),_.each(this._fileInfoParsers,function(t){_.extend(o,t(e,o)||{})}),new i(o)},_parseResult:function(e){let t=this;return _.map(e,function(e){return t._parseFileInfo(e)})},_isSuccessStatus:function(e){return e>=200&&e<=299},_getSabreException:function(e){let t={},s=e.xhr.responseXML;if(null===s)return t;let r=s.getElementsByTagNameNS("http://sabredav.org/ns","message"),i=s.getElementsByTagNameNS("http://sabredav.org/ns","exception");return r.length&&(t.message=r[0].textContent),i.length&&(t.exception=i[0].textContent),t},getPropfindProperties:function(){return this._propfindProperties||(this._propfindProperties=_.map(n._PROPFIND_PROPERTIES,function(e){return"{"+e[0]+"}"+e[1]})),this._propfindProperties},getFolderContents:function(e,t){let s;e||(e=""),t=t||{};let r=this,i=$.Deferred(),n=i.promise();return s=_.isUndefined(t.properties)?this.getPropfindProperties():t.properties,this._client.propFind(this._buildUrl(e),s,1).then(function(e){if(r._isSuccessStatus(e.status)){let s=r._parseResult(e.body);t&&t.includeParent||s.shift(),i.resolve(e.status,s)}else e=_.extend(e,r._getSabreException(e)),i.reject(e.status,e)}),n},getFilteredFiles:function(e,t){let s,r;t=t||{};let i=this,n=$.Deferred(),a=n.promise();if(s=_.isUndefined(t.properties)?this.getPropfindProperties():t.properties,!e||!e.systemTagIds&&_.isUndefined(e.favorite)&&!e.circlesIds)throw"Missing filter argument";let l="<oc:filter-files ";for(r in this._client.xmlNamespaces)l+=" xmlns:"+this._client.xmlNamespaces[r]+'="'+r+'"';return l+=">\n    <"+this._client.xmlNamespaces["DAV:"]+":prop>\n",_.each(s,function(e){let t=i._client.parseClarkNotation(e);l+="        <"+i._client.xmlNamespaces[t.namespace]+":"+t.name+" />\n"}),l+="    </"+this._client.xmlNamespaces["DAV:"]+":prop>\n    <oc:filter-rules>\n",_.each(e.systemTagIds,function(e){l+="        <oc:systemtag>"+o(e)+"</oc:systemtag>\n"}),_.each(e.circlesIds,function(e){l+="        <oc:circle>"+o(e)+"</oc:circle>\n"}),e.favorite&&(l+="        <oc:favorite>"+(e.favorite?"1":"0")+"</oc:favorite>\n"),l+="    </oc:filter-rules>\n</oc:filter-files>\n",this._client.request("REPORT",this._buildUrl(),{},l).then(function(e){if(i._isSuccessStatus(e.status)){let t=i._parseResult(e.body);n.resolve(e.status,t)}else e=_.extend(e,i._getSabreException(e)),n.reject(e.status,e)}),a},getFileInfo:function(e,t){let s;e||(e=""),t=t||{};let r=this,i=$.Deferred(),n=i.promise();return s=_.isUndefined(t.properties)?this.getPropfindProperties():t.properties,this._client.propFind(this._buildUrl(e),s,0).then(function(e){r._isSuccessStatus(e.status)?i.resolve(e.status,r._parseResult([e.body])[0]):(e=_.extend(e,r._getSabreException(e)),i.reject(e.status,e))}),n},getFileContents:function(e){if(!e)throw'Missing argument "path"';let t=this,s=$.Deferred(),r=s.promise();return this._client.request("GET",this._buildUrl(e)).then(function(e){t._isSuccessStatus(e.status)?s.resolve(e.status,e.body):(e=_.extend(e,t._getSabreException(e)),s.reject(e.status,e))}),r},putFileContents:function(e,t,s){if(!e)throw'Missing argument "path"';let r=this,i=$.Deferred(),n=i.promise(),o={},a="text/plain;charset=utf-8";return(s=s||{}).contentType&&(a=s.contentType),o["Content-Type"]=a,(_.isUndefined(s.overwrite)||s.overwrite)&&(o["If-None-Match"]="*"),this._client.request("PUT",this._buildUrl(e),o,t||"").then(function(e){r._isSuccessStatus(e.status)?i.resolve(e.status):(e=_.extend(e,r._getSabreException(e)),i.reject(e.status,e))}),n},_simpleCall:function(e,t,s){if(!t)throw'Missing argument "path"';let r=this,i=$.Deferred(),n=i.promise();return this._client.request(e,this._buildUrl(t),s||{}).then(function(e){r._isSuccessStatus(e.status)?i.resolve(e.status):(e=_.extend(e,r._getSabreException(e)),i.reject(e.status,e))}),n},createDirectory:function(e,t){return this._simpleCall("MKCOL",e,t)},remove:function(e){return this._simpleCall("DELETE",e)},move:function(e,t,s,r){if(!e)throw'Missing argument "path"';if(!t)throw'Missing argument "destinationPath"';let i=this,n=$.Deferred(),o=n.promise();return r=_.extend({},r,{Destination:this._buildUrl(t)}),s||(r.Overwrite="F"),this._client.request("MOVE",this._buildUrl(e),r).then(function(e){i._isSuccessStatus(e.status)?n.resolve(e.status):(e=_.extend(e,i._getSabreException(e)),n.reject(e.status,e))}),o},copy:function(e,t,s){if(!e)throw'Missing argument "path"';if(!t)throw'Missing argument "destinationPath"';let r=this,i=$.Deferred(),n=i.promise(),o={Destination:this._buildUrl(t)};return s||(o.Overwrite="F"),this._client.request("COPY",this._buildUrl(e),o).then(function(e){r._isSuccessStatus(e.status)?i.resolve(e.status):i.reject(e.status)}),n},addFileInfoParser:function(e){this._fileInfoParsers.push(e)},getClient:function(){return this._client},getUserName:function(){return this._client.userName},getPassword:function(){return this._client.password},getBaseUrl:function(){return this._client.baseUrl},getHost:function(){return this._host}},r.Files||(r.Files={}),r.Files.getClient=function(){if(r.Files._defaultClient)return r.Files._defaultClient;let e=new r.Files.Client({host:r.getHost(),port:r.getPort(),root:r.linkToRemoteBase("dav")+"/files/"+r.getCurrentUser().uid,useHTTPS:"https"===r.getProtocol()});return r.Files._defaultClient=e,e},r.Files.Client=n}},n={};function o(e){var t=n[e];if(void 0!==t)return t.exports;var s=n[e]={id:e,exports:{}};return i[e].call(s.exports,s,s.exports,o),s.exports}o.m=i,o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var s in t)o.o(t,s)&&!o.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},o.g=(()=>{if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}})(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},e=[],o.O=(t,s,r,i)=>{if(s){i=i||0;for(var n=e.length;n>0&&e[n-1][2]>i;n--)e[n]=e[n-1];e[n]=[s,r,i];return}for(var a=1/0,n=0;n<e.length;n++){for(var s=e[n][0],r=e[n][1],i=e[n][2],l=!0,u=0;u<s.length;u++)(!1&i||a>=i)&&Object.keys(o.O).every(e=>o.O[e](s[u]))?s.splice(u--,1):(l=!1,i<a&&(a=i));if(l){e.splice(n--,1);var c=r();void 0!==c&&(t=c)}}return t},o.rv=()=>"1.5.7",o.j="331",t={331:0},o.O.j=e=>0===t[e],s=(e,s)=>{var r,i,n=s[0],a=s[1],l=s[2],u=0;if(n.some(e=>0!==t[e])){for(r in a)o.o(a,r)&&(o.m[r]=a[r]);if(l)var c=l(o)}for(e&&e(s);u<n.length;u++)i=n[u],o.o(t,i)&&t[i]&&t[i][0](),t[i]=0;return o.O(c)},(r=self.webpackChunk_nextcloud_app_core=self.webpackChunk_nextcloud_app_core||[]).forEach(s.bind(null,0)),r.push=s.bind(null,r.push.bind(r)),o.ruid="bundler=rspack@1.5.7";var a=o.O(void 0,["441"],function(){return o(64706)});a=o.O(a)})();
//# sourceMappingURL=core-files_client.js.map