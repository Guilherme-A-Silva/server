(()=>{"use strict";var e,t,r,n={26436:(e,t,r)=>{var n,o=r(32981),s=r(53334),i=r(35810),a=r(56760),l=r(63814),c=r(85168),u=r(19051),d=r(85471);!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.ERROR=1]="ERROR",e[e.INDETERMINATE=2]="INDETERMINATE",e[e.INCOMPLETE_CONF=3]="INCOMPLETE_CONF",e[e.UNAUTHORIZED=4]="UNAUTHORIZED",e[e.TIMEOUT=5]="TIMEOUT",e[e.NETWORK_ERROR=6]="NETWORK_ERROR"}(n||(n={}));const f=function(e){return!(!e.status||e.status===n.SUCCESS)&&(e.userProvided||"password::global::user"===e.authMechanism)},p=function(e){if(e.type===i.pt.File)return!1;const t=e.attributes;return!(!t.scope||!t.backend||"personal"!==t.scope&&"system"!==t.scope)};(0,a.IF)(u.Ay);const A=new i.hY({id:"credentials-external-storage",displayName:()=>(0,s.Tl)("files","Enter missing credentials"),iconSvgInline:()=>'<svg xmlns="http://www.w3.org/2000/svg" id="mdi-login" viewBox="0 0 24 24"><path d="M11 7L9.6 8.4L12.2 11H2V13H12.2L9.6 15.6L11 17L16 12L11 7M20 19H12V21H20C21.1 21 22 20.1 22 19V5C22 3.9 21.1 3 20 3H12V5H20V19Z" /></svg>',enabled:e=>{var t;if(1!==e.length)return!1;const r=e[0];if(!p(r))return!1;const n=(null===(t=r.attributes)||void 0===t?void 0:t.config)||{};return!!f(n)},async exec(e){const{login:t,password:o}=await new Promise((e=>(0,c.Ss)((0,d.$V)((()=>Promise.all([r.e(4208),r.e(7367)]).then(r.bind(r,7367)))),{},(t=>{e(t)}))));if(t&&o)try{await async function(e,t,r){const o=(await u.Ay.request({method:"PUT",url:(0,l.Jv)("apps/files_external/userglobalstorages/{id}",{id:e.attributes.id}),confirmPassword:a.mH.Strict,data:{backendOptions:{user:t,password:r}}})).data;return o.status!==n.SUCCESS?((0,c.Qg)((0,s.Tl)("files_external","Unable to update this external storage config. {statusMessage}",{statusMessage:(null==o?void 0:o.statusMessage)||""})),null):((0,c.Te)((0,s.Tl)("files_external","New configuration successfully saved")),d.Ay.set(e.attributes,"config",o),!0)}(e,t,o),(0,c.Te)((0,s.Tl)("files_external","Credentials successfully set"))}catch(e){(0,c.Qg)((0,s.Tl)("files_external","Error while setting credentials: {error}",{error:e.message}))}return null},order:-1e3,default:i.m9.DEFAULT,inline:()=>!0});var g=r(85072),v=r.n(g),m=r(97825),h=r.n(m),w=r(77659),b=r.n(w),C=r(55056),y=r.n(C),x=r(10540),T=r.n(x),E=r(41113),O=r.n(E),S=r(64755),_={};_.styleTagTransform=O(),_.setAttributes=y(),_.insert=b().bind(null,"head"),_.domAPI=h(),_.insertStyleElement=T(),v()(S.A,_),S.A&&S.A.locals&&S.A.locals;var P,H=r(21777);function N(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?N(Object(r),!0).forEach((function(t){j(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function j(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const I="/files/".concat(null===(P=(0,H.HW)())||void 0===P?void 0:P.uid),M=e=>{var t;const r=(e.path+"/"+e.name).replace(/^\//gm,"");return new i.vd({id:e.id,source:(0,l.dC)("dav"+I+"/"+r),root:I,owner:(null===(t=(0,H.HW)())||void 0===t?void 0:t.uid)||null,permissions:e.config.status!==n.SUCCESS?i.aX.NONE:(null==e?void 0:e.permissions)||i.aX.READ,attributes:k({displayName:r},e)})},R=new i.hY({id:"check-external-storage",displayName:()=>"",iconSvgInline:()=>"",enabled:e=>e.every((e=>!0===p(e))),exec:async()=>null,async renderInline(e){const t=document.createElement("span");t.className="files-list__row-status",t.innerHTML=(0,s.Tl)("files_external","Checking storage â€¦");let r=null;return function(e){const t=arguments.length>1&&void 0!==arguments[1]&&!arguments[1]?"userstorages":"userglobalstorages";return u.Ay.get((0,l.Jv)("apps/files_external/".concat(t,"/").concat(e,"?testOnly=false")))}(e.attributes.id,"system"===e.attributes.scope).then((o=>{var i;if(r=o.data,d.Ay.set(e.attributes,"config",r),r.status!==n.SUCCESS)throw new Error((null===(i=r)||void 0===i?void 0:i.statusMessage)||(0,s.Tl)("files_external","There was an error with this external storage."));t.remove()})).catch((n=>{n.response&&!r&&(0,c.I9)((0,s.Tl)("files_external","We were unable to check the external storage {basename}",{basename:e.basename})),t.innerHTML="";const o=!!r&&f(r),i=document.createElement("span");i.classList.add("files-list__row-status--".concat(o?"warning":"error")),o||(t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-alert-circle" viewBox="0 0 24 24"><path d="M13,13H11V7H13M13,17H11V15H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z" /></svg>',t.title=n.message),t.prepend(i)})),t},order:10}),U=new i.hY({id:"open-in-files-external-storage",displayName:e=>{var t;return((null==e||null===(t=e[0])||void 0===t||null===(t=t.attributes)||void 0===t?void 0:t.config)||{status:n.INDETERMINATE}).status!==n.SUCCESS?(0,s.Tl)("files_external","Examine this faulty external storage configuration"):(0,s.Tl)("files","Open in Files")},iconSvgInline:()=>"",enabled:(e,t)=>"extstoragemounts"===t.id,async exec(e){const t=e.attributes.config;return(null==t?void 0:t.status)!==n.SUCCESS?(window.OC.dialogs.confirm((0,s.Tl)("files_external","There was an error with this external storage. Do you want to review this mount point config in the settings page?"),(0,s.Tl)("files_external","External mount error"),(e=>{if(!0===e){var t;const e=null!==(t=(0,H.HW)())&&void 0!==t&&t.isAdmin?"admin":"user";window.location.href=(0,l.Jv)("/settings/".concat(e,"/externalstorages"))}})),null):(window.OCP.Files.Router.goToRoute(null,{view:"files"},{dir:e.path}),null)},order:-1e3,default:i.m9.HIDDEN}),D=(0,o.C)("files_external","allowUserMounting",!1);(0,i.bh)().register(new i.Ss({id:"extstoragemounts",name:(0,s.Tl)("files_external","External storage"),caption:(0,s.Tl)("files_external","List of external storage."),emptyCaption:D?(0,s.Tl)("files_external","There is no external storage configured. You can configure them in your Personal settings."):(0,s.Tl)("files_external","There is no external storage configured and you don't have the permission to configure them."),emptyTitle:(0,s.Tl)("files_external","No external storage"),icon:'<svg xmlns="http://www.w3.org/2000/svg" id="mdi-folder-network" viewBox="0 0 24 24"><path d="M3,15V5A2,2 0 0,1 5,3H11L13,5H19A2,2 0 0,1 21,7V15A2,2 0 0,1 19,17H13V19H14A1,1 0 0,1 15,20H22V22H15A1,1 0 0,1 14,23H10A1,1 0 0,1 9,22H2V20H9A1,1 0 0,1 10,19H11V17H5A2,2 0 0,1 3,15Z" /></svg>',order:30,columns:[new i.VP({id:"storage-type",title:(0,s.Tl)("files_external","Storage type"),render(e){var t;const r=(null===(t=e.attributes)||void 0===t?void 0:t.backend)||(0,s.Tl)("files_external","Unknown"),n=document.createElement("span");return n.textContent=r,n}}),new i.VP({id:"scope",title:(0,s.Tl)("files_external","Scope"),render(e){var t;const r=document.createElement("span");let n=(0,s.Tl)("files_external","Personal");return"system"===(null===(t=e.attributes)||void 0===t?void 0:t.scope)&&(n=(0,s.Tl)("files_external","System")),r.textContent=n,r}})],getContents:async()=>{var e;const t=(await u.Ay.get((0,l.KT)("apps/files_external/api/v1/mounts"))).data.ocs.data.map(M);return{folder:new i.vd({id:0,source:(0,l.dC)("dav"+I),root:I,owner:(null===(e=(0,H.HW)())||void 0===e?void 0:e.uid)||null,permissions:i.aX.READ}),contents:t}}})),(0,i.Gg)(A),(0,i.Gg)(R),(0,i.Gg)(U)},64755:(e,t,r)=>{r.d(t,{A:()=>a});var n=r(71354),o=r.n(n),s=r(76314),i=r.n(s)()(o());i.push([e.id,"/*!\n * SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */.files-list__row-status{display:flex;min-width:44px;justify-content:center;align-items:center;height:100%;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.files-list__row-status svg{width:24px;height:24px}.files-list__row-status svg path{fill:currentColor}.files-list__row-status--error,.files-list__row-status--warning{position:absolute;display:block;top:0;left:0;right:0;bottom:0;opacity:.1;z-index:-1}.files-list__row-status--error{background:var(--color-error)}.files-list__row-status--warning{background:var(--color-warning)}","",{version:3,sources:["webpack://./apps/files_external/src/css/fileEntryStatus.scss"],names:[],mappings:"AAAA;;;EAAA,CAIA,wBACC,YAAA,CACA,cAAA,CACA,sBAAA,CACA,kBAAA,CACA,WAAA,CACA,sBAAA,CACA,kBAAA,CACA,eAAA,CAEA,4BACC,UAAA,CACA,WAAA,CAEA,iCACC,iBAAA,CAIF,gEAEC,iBAAA,CACA,aAAA,CACA,KAAA,CACA,MAAA,CACA,OAAA,CACA,QAAA,CACA,UAAA,CACA,UAAA,CAGD,+BACC,6BAAA,CAGD,iCACC,+BAAA",sourcesContent:["/*!\n * SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n.files-list__row-status {\n\tdisplay: flex;\n\tmin-width: 44px;\n\tjustify-content: center;\n\talign-items: center;\n\theight: 100%;\n\ttext-overflow: ellipsis;\n\twhite-space: nowrap;\n\toverflow: hidden;\n\n\tsvg {\n\t\twidth: 24px;\n\t\theight: 24px;\n\n\t\tpath {\n\t\t\tfill: currentColor;\n\t\t}\n\t}\n\n\t&--error,\n\t&--warning {\n\t\tposition: absolute;\n\t\tdisplay: block;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\tbottom: 0;\n\t\topacity: .1;\n\t\tz-index: -1;\n\t}\n\n\t&--error {\n\t\tbackground: var(--color-error);\n\t}\n\n\t&--warning {\n\t\tbackground: var(--color-warning);\n\t}\n}\n"],sourceRoot:""}]);const a=i}},o={};function s(e){var t=o[e];if(void 0!==t)return t.exports;var r=o[e]={id:e,loaded:!1,exports:{}};return n[e].call(r.exports,r,r.exports,s),r.loaded=!0,r.exports}s.m=n,e=[],s.O=(t,r,n,o)=>{if(!r){var i=1/0;for(u=0;u<e.length;u++){for(var[r,n,o]=e[u],a=!0,l=0;l<r.length;l++)(!1&o||i>=o)&&Object.keys(s.O).every((e=>s.O[e](r[l])))?r.splice(l--,1):(a=!1,o<i&&(i=o));if(a){e.splice(u--,1);var c=n();void 0!==c&&(t=c)}}return t}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[r,n,o]},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce(((t,r)=>(s.f[r](e,t),t)),[])),s.u=e=>e+"-"+e+".js?v="+{640:"d8bb2b1f4eeab8f50472",4057:"8944d2d651d7e00d9b30",5771:"d141d1ad8187d99738b9",7367:"7731b149c0ec6a2e8c85",7471:"6423b9b898ffefeb7d1d"}[e],s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),t={},r="nextcloud:",s.l=(e,n,o,i)=>{if(t[e])t[e].push(n);else{var a,l;if(void 0!==o)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==e||d.getAttribute("data-webpack")==r+o){a=d;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",s.nc&&a.setAttribute("nonce",s.nc),a.setAttribute("data-webpack",r+o),a.src=e),t[e]=[n];var f=(r,n)=>{a.onerror=a.onload=null,clearTimeout(p);var o=t[e];if(delete t[e],a.parentNode&&a.parentNode.removeChild(a),o&&o.forEach((e=>e(n))),r)return r(n)},p=setTimeout(f.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=f.bind(null,a.onerror),a.onload=f.bind(null,a.onload),l&&document.head.appendChild(a)}},s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),s.j=1873,(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var n=r.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=r[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e})(),(()=>{s.b="undefined"!=typeof document&&document.baseURI||self.location.href;var e={1873:0};s.f.j=(t,r)=>{var n=s.o(e,t)?e[t]:void 0;if(0!==n)if(n)r.push(n[2]);else{var o=new Promise(((r,o)=>n=e[t]=[r,o]));r.push(n[2]=o);var i=s.p+s.u(t),a=new Error;s.l(i,(r=>{if(s.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var o=r&&("load"===r.type?"missing":r.type),i=r&&r.target&&r.target.src;a.message="Loading chunk "+t+" failed.\n("+o+": "+i+")",a.name="ChunkLoadError",a.type=o,a.request=i,n[1](a)}}),"chunk-"+t,t)}},s.O.j=t=>0===e[t];var t=(t,r)=>{var n,o,[i,a,l]=r,c=0;if(i.some((t=>0!==e[t]))){for(n in a)s.o(a,n)&&(s.m[n]=a[n]);if(l)var u=l(s)}for(t&&t(r);c<i.length;c++)o=i[c],s.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return s.O(u)},r=self.webpackChunknextcloud=self.webpackChunknextcloud||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),s.nc=void 0;var i=s.O(void 0,[4208],(()=>s(26436)));i=s.O(i)})();
//# sourceMappingURL=files_external-init.js.map?v=437e000ffd738bdf4763