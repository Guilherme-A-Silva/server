(()=>{var e,t,s,a={2450:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var a=s(71354),r=s.n(a),n=s(76314),i=s.n(n)()(r());i.push([e.id,".system-tag-form[data-v-36ae2802]{display:flex;flex-direction:column;max-width:400px;gap:8px 0}.system-tag-form__group[data-v-36ae2802]{display:flex;flex-direction:column}.system-tag-form__row[data-v-36ae2802]{margin-top:8px;display:flex;gap:0 4px}","",{version:3,sources:["webpack://./apps/systemtags/src/components/SystemTagForm.vue"],names:[],mappings:"AACA,kCACC,YAAA,CACA,qBAAA,CACA,eAAA,CACA,SAAA,CAEA,yCACC,YAAA,CACA,qBAAA,CAGD,uCACC,cAAA,CACA,YAAA,CACA,SAAA",sourcesContent:["\n.system-tag-form {\n\tdisplay: flex;\n\tflex-direction: column;\n\tmax-width: 400px;\n\tgap: 8px 0;\n\n\t&__group {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t}\n\n\t&__row {\n\t\tmargin-top: 8px;\n\t\tdisplay: flex;\n\t\tgap: 0 4px;\n\t}\n}\n"],sourceRoot:""}]);const o=i},29641:(e,t,s)=>{"use strict";var a=s(21777),r=s(85471),n=s(2645),i=s(88837),o=s(53334),l=s(85168),c=s(21376),d=s(67607),g=s(5212),u=s(82182);const p=/[\p{Lu}]/u,m=/[\p{Ll}]/u,y=/^[\p{Lu}](?![\p{Lu}])/gu,b=/([\p{Alpha}\p{N}_]|$)/u,h=/[_.\- ]+/,f=new RegExp("^"+h.source),v=new RegExp(h.source+b.source,"gu"),A=new RegExp("\\d+"+b.source,"gu");function T(e,t){if("string"!=typeof e&&!Array.isArray(e))throw new TypeError("Expected the input to be `string | string[]`");if(t={pascalCase:!1,preserveConsecutiveUppercase:!1,...t},0===(e=Array.isArray(e)?e.map((e=>e.trim())).filter((e=>e.length)).join("-"):e.trim()).length)return"";const s=!1===t.locale?e=>e.toLowerCase():e=>e.toLocaleLowerCase(t.locale),a=!1===t.locale?e=>e.toUpperCase():e=>e.toLocaleUpperCase(t.locale);return 1===e.length?h.test(e)?"":t.pascalCase?a(e):s(e):(e!==s(e)&&(e=((e,t,s,a)=>{let r=!1,n=!1,i=!1,o=!1;for(let l=0;l<e.length;l++){const c=e[l];o=!(l>2)||"-"===e[l-3],r&&p.test(c)?(e=e.slice(0,l)+"-"+e.slice(l),r=!1,i=n,n=!0,l++):n&&i&&m.test(c)&&(!o||a)?(e=e.slice(0,l-1)+"-"+e.slice(l-1),i=n,n=!1,r=!0):(r=t(c)===c&&s(c)!==c,i=n,n=s(c)===c&&t(c)!==c)}return e})(e,s,a,t.preserveConsecutiveUppercase)),e=e.replace(f,""),e=t.preserveConsecutiveUppercase?((e,t)=>(y.lastIndex=0,e.replaceAll(y,(e=>t(e)))))(e,s):s(e),t.pascalCase&&(e=a(e.charAt(0))+e.slice(1)),((e,t)=>(v.lastIndex=0,A.lastIndex=0,e.replaceAll(A,((s,a,r)=>["_","-"].includes(e.charAt(r+s.length))?s:t(s))).replaceAll(v,((e,s)=>t(s)))))(e,a))}function w(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function C(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?w(Object(s),!0).forEach((function(t){_(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):w(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function _(e,t,s){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const x={userVisible:!0,userAssignable:!0,canAssign:!0};s(19051);var O=s(60669);const P=(0,s(63814).dC)("dav"),j=(0,O.UU)(P),N=e=>{j.setHeaders({"X-Requested-With":"XMLHttpRequest",requesttoken:null!=e?e:""})};(0,a.zo)(N),N((0,a.do)());const S=(0,s(35947).YK)().setApp("systemtags").detectUser().build();function L(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function E(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?L(Object(s),!0).forEach((function(t){D(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):L(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function D(e,t,s){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var I;!function(e){e.Public="Public",e.Restricted="Restricted",e.Invisible="Invisible"}(I||(I={}));const R=[{id:I.Public,label:(0,o.Tl)("systemtags","Public")},{id:I.Restricted,label:(0,o.Tl)("systemtags","Restricted")},{id:I.Invisible,label:(0,o.Tl)("systemtags","Invisible")}],k=(e,t)=>({[[!0,!0].join(",")]:I.Public,[[!0,!1].join(",")]:I.Restricted,[[!1,!1].join(",")]:I.Invisible}[[e,t].join(",")]),F=r.Ay.extend({name:"SystemTagForm",components:{NcButton:c.A,NcLoadingIcon:n.A,NcSelect:d.default,NcSelectTags:g.A,NcTextField:u.A},props:{tags:{type:Array,required:!0}},data:()=>({loading:!1,tagLevelOptions:R,selectedTag:null,errorMessage:"",tagName:"",tagLevel:I.Public}),watch:{selectedTag(e){this.tagName=e?e.displayName:"",this.tagLevel=e?k(e.userVisible,e.userAssignable):I.Public}},computed:{isCreating(){return null===this.selectedTag},isCreateDisabled(){return""===this.tagName},isUpdateDisabled(){var e,t,s;return""===this.tagName||(null===(e=this.selectedTag)||void 0===e?void 0:e.displayName)===this.tagName&&k(null===(t=this.selectedTag)||void 0===t?void 0:t.userVisible,null===(s=this.selectedTag)||void 0===s?void 0:s.userAssignable)===this.tagLevel},isResetDisabled(){return this.isCreating?""===this.tagName&&this.tagLevel===I.Public:null===this.selectedTag},userVisible(){return{[I.Public]:!0,[I.Restricted]:!0,[I.Invisible]:!1}[this.tagLevel]},userAssignable(){return{[I.Public]:!0,[I.Restricted]:!1,[I.Invisible]:!1}[this.tagLevel]},tagProperties(){return{displayName:this.tagName,userVisible:this.userVisible,userAssignable:this.userAssignable}}},methods:{t:o.Tl,async handleSubmit(){this.isCreating?await this.create():await this.update()},async create(){const e=E(E({},x),this.tagProperties);this.loading=!0;try{const t=await(async e=>{const t=(e=>{if("name"in e&&!("displayName"in e))return C({},e);const t=C({},e);return t.name=t.displayName,delete t.displayName,t})(e);try{const{headers:e}=await j.customRequest("/systemtags",{method:"POST",data:t}),s=e.get("content-location");if(s)return(e=>{const t=e.indexOf("?");t>0&&(e=e.substring(0,t));const s=e.split("/");let a;do{a=s[s.length-1],s.pop()}while(!a&&s.length>0);return Number(a)})(s);throw S.error((0,o.Tl)("systemtags",'Missing "Content-Location" header')),new Error((0,o.Tl)("systemtags",'Missing "Content-Location" header'))}catch(e){throw S.error((0,o.Tl)("systemtags","Failed to create tag"),{error:e}),new Error((0,o.Tl)("systemtags","Failed to create tag"))}})(e),s=E(E({},e),{},{id:t});this.$emit("tag:created",s),(0,l.Te)((0,o.Tl)("systemtags","Created tag")),this.reset()}catch(e){this.errorMessage=(0,o.Tl)("systemtags","Failed to create tag")}this.loading=!1},async update(){if(null===this.selectedTag)return;const e=E(E({},this.selectedTag),this.tagProperties);this.loading=!0;try{var t;await(async e=>{const t="/systemtags/"+e.id,s='<?xml version="1.0"?>\n\t<d:propertyupdate  xmlns:d="DAV:" xmlns:oc="http://owncloud.org/ns">\n\t\t<d:set>\n\t\t\t<d:prop>\n\t\t\t\t<oc:display-name>'.concat(e.displayName,"</oc:display-name>\n\t\t\t\t<oc:user-visible>").concat(e.userVisible,"</oc:user-visible>\n\t\t\t\t<oc:user-assignable>").concat(e.userAssignable,"</oc:user-assignable>\n\t\t\t</d:prop>\n\t\t</d:set>\n\t</d:propertyupdate>");try{await j.customRequest(t,{method:"PROPPATCH",data:s})}catch(e){throw S.error((0,o.Tl)("systemtags","Failed to update tag"),{error:e}),new Error((0,o.Tl)("systemtags","Failed to update tag"))}})(e),this.selectedTag=e,this.$emit("tag:updated",e),(0,l.Te)((0,o.Tl)("systemtags","Updated tag")),null===(t=this.$refs.tagNameInput)||void 0===t||t.focus()}catch(e){this.errorMessage=(0,o.Tl)("systemtags","Failed to update tag")}this.loading=!1},async handleDelete(){if(null!==this.selectedTag){this.loading=!0;try{await(async()=>{const e="/systemtags/"+this.selectedTag.id;try{await j.deleteFile(e)}catch(e){throw S.error((0,o.Tl)("systemtags","Failed to delete tag"),{error:e}),new Error((0,o.Tl)("systemtags","Failed to delete tag"))}})(),this.$emit("tag:deleted",this.selectedTag),(0,l.Te)((0,o.Tl)("systemtags","Deleted tag")),this.reset()}catch(e){this.errorMessage=(0,o.Tl)("systemtags","Failed to delete tag")}this.loading=!1}},reset(){var e;this.selectedTag=null,this.errorMessage="",this.tagName="",this.tagLevel=I.Public,null===(e=this.$refs.tagNameInput)||void 0===e||e.focus()}}});var U=s(85072),M=s.n(U),B=s(97825),V=s.n(B),$=s(77659),q=s.n($),Y=s(55056),z=s.n(Y),H=s(10540),X=s.n(H),G=s(41113),K=s.n(G),Q=s(2450),W={};W.styleTagTransform=K(),W.setAttributes=z(),W.insert=q().bind(null,"head"),W.domAPI=V(),W.insertStyleElement=X(),M()(Q.A,W),Q.A&&Q.A.locals&&Q.A.locals;var J=s(14486);const Z=(0,J.A)(F,(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("form",{staticClass:"system-tag-form",attrs:{disabled:e.loading,"aria-labelledby":"system-tag-form-heading"},on:{submit:function(t){return t.preventDefault(),e.handleSubmit.apply(null,arguments)},reset:e.reset}},[t("h3",{attrs:{id:"system-tag-form-heading"}},[e._v("\n\t\t"+e._s(e.t("systemtags","Create or edit tags"))+"\n\t")]),e._v(" "),t("div",{staticClass:"system-tag-form__group"},[t("label",{attrs:{for:"system-tags-input"}},[e._v(e._s(e.t("systemtags","Search for a tag to edit")))]),e._v(" "),t("NcSelectTags",{attrs:{"input-id":"system-tags-input",placeholder:e.t("systemtags","Collaborative tags â€¦"),"fetch-tags":!1,options:e.tags,multiple:!1,passthru:""},scopedSlots:e._u([{key:"no-options",fn:function(){return[e._v("\n\t\t\t\t"+e._s(e.t("systemtags","No tags to select"))+"\n\t\t\t")]},proxy:!0}]),model:{value:e.selectedTag,callback:function(t){e.selectedTag=t},expression:"selectedTag"}})],1),e._v(" "),t("div",{staticClass:"system-tag-form__group"},[t("label",{attrs:{for:"system-tag-name"}},[e._v(e._s(e.t("systemtags","Tag name")))]),e._v(" "),t("NcTextField",{ref:"tagNameInput",attrs:{id:"system-tag-name",value:e.tagName,error:Boolean(e.errorMessage),"helper-text":e.errorMessage,"label-outside":""},on:{"update:value":function(t){e.tagName=t}}})],1),e._v(" "),t("div",{staticClass:"system-tag-form__group"},[t("label",{attrs:{for:"system-tag-level"}},[e._v(e._s(e.t("systemtags","Tag level")))]),e._v(" "),t("NcSelect",{attrs:{"input-id":"system-tag-level",options:e.tagLevelOptions,reduce:e=>e.id,clearable:!1,disabled:e.loading},model:{value:e.tagLevel,callback:function(t){e.tagLevel=t},expression:"tagLevel"}})],1),e._v(" "),t("div",{staticClass:"system-tag-form__row"},[e.isCreating?t("NcButton",{attrs:{"native-type":"submit",disabled:e.isCreateDisabled||e.loading}},[e._v("\n\t\t\t"+e._s(e.t("systemtags","Create"))+"\n\t\t")]):[t("NcButton",{attrs:{"native-type":"submit",disabled:e.isUpdateDisabled||e.loading}},[e._v("\n\t\t\t\t"+e._s(e.t("systemtags","Update"))+"\n\t\t\t")]),e._v(" "),t("NcButton",{attrs:{disabled:e.loading},on:{click:e.handleDelete}},[e._v("\n\t\t\t\t"+e._s(e.t("systemtags","Delete"))+"\n\t\t\t")])],e._v(" "),t("NcButton",{attrs:{"native-type":"reset",disabled:e.isResetDisabled||e.loading}},[e._v("\n\t\t\t"+e._s(e.t("systemtags","Reset"))+"\n\t\t")]),e._v(" "),e.loading?t("NcLoadingIcon",{attrs:{name:e.t("systemtags","Loading â€¦"),size:32}}):e._e()],2)])}),[],!1,null,"36ae2802",null).exports,ee=r.Ay.extend({name:"SystemTagsSection",components:{NcLoadingIcon:n.A,NcSettingsSection:i.A,SystemTagForm:Z},data:()=>({loadingTags:!1,tags:[]}),async created(){this.loadingTags=!0;try{this.tags=await(async()=>{try{const{data:e}=await j.getDirectoryContents("/systemtags",{data:'<?xml version="1.0"?>\n<d:propfind  xmlns:d="DAV:" xmlns:oc="http://owncloud.org/ns">\n\t<d:prop>\n\t\t<oc:id />\n\t\t<oc:display-name />\n\t\t<oc:user-visible />\n\t\t<oc:user-assignable />\n\t\t<oc:can-assign />\n\t</d:prop>\n</d:propfind>',details:!0,glob:"/systemtags/*"});return(e=>e.map((e=>{let{props:t}=e;return Object.fromEntries(Object.entries(t).map((e=>{let[t,s]=e;return[T(t),"displayName"===T(t)?String(s):s]})))})))(e)}catch(e){throw S.error((0,o.Tl)("systemtags","Failed to load tags"),{error:e}),new Error((0,o.Tl)("systemtags","Failed to load tags"))}})()}catch(e){(0,l.Qg)((0,o.Tl)("systemtags","Failed to load tags"))}this.loadingTags=!1},methods:{t:o.Tl,handleCreate(e){this.tags.unshift(e)},handleUpdate(e){const t=this.tags.findIndex((t=>t.id===e.id));this.tags.splice(t,1),this.tags.unshift(e)},handleDelete(e){const t=this.tags.findIndex((t=>t.id===e.id));this.tags.splice(t,1)}}}),te=(0,J.A)(ee,(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("NcSettingsSection",{attrs:{name:e.t("systemtags","Collaborative tags"),description:e.t("systemtags","Collaborative tags are available for all users. Restricted tags are visible to users but cannot be assigned by them. Invisible tags are for internal use, since users cannot see or assign them.")}},[e.loadingTags?t("NcLoadingIcon",{attrs:{name:e.t("systemtags","Loading collaborative tags â€¦"),size:32}}):t("SystemTagForm",{attrs:{tags:e.tags},on:{"tag:created":e.handleCreate,"tag:updated":e.handleUpdate,"tag:deleted":e.handleDelete}})],1)}),[],!1,null,null,null).exports;s.nc=(0,a.aV)(),(new(r.Ay.extend(te))).$mount("#vue-admin-systemtags")},42634:()=>{},59169:()=>{},63779:()=>{},77199:()=>{},86833:()=>{}},r={};function n(e){var t=r[e];if(void 0!==t)return t.exports;var s=r[e]={id:e,loaded:!1,exports:{}};return a[e].call(s.exports,s,s.exports,n),s.loaded=!0,s.exports}n.m=a,e=[],n.O=(t,s,a,r)=>{if(!s){var i=1/0;for(d=0;d<e.length;d++){for(var[s,a,r]=e[d],o=!0,l=0;l<s.length;l++)(!1&r||i>=r)&&Object.keys(n.O).every((e=>n.O[e](s[l])))?s.splice(l--,1):(o=!1,r<i&&(i=r));if(o){e.splice(d--,1);var c=a();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[s,a,r]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,s)=>(n.f[s](e,t),t)),[])),n.u=e=>e+"-"+e+".js?v="+{640:"d8bb2b1f4eeab8f50472",4057:"8944d2d651d7e00d9b30",5771:"d141d1ad8187d99738b9",7471:"6423b9b898ffefeb7d1d"}[e],n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),t={},s="nextcloud:",n.l=(e,a,r,i)=>{if(t[e])t[e].push(a);else{var o,l;if(void 0!==r)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var g=c[d];if(g.getAttribute("src")==e||g.getAttribute("data-webpack")==s+r){o=g;break}}o||(l=!0,(o=document.createElement("script")).charset="utf-8",n.nc&&o.setAttribute("nonce",n.nc),o.setAttribute("data-webpack",s+r),o.src=e),t[e]=[a];var u=(s,a)=>{o.onerror=o.onload=null,clearTimeout(p);var r=t[e];if(delete t[e],o.parentNode&&o.parentNode.removeChild(o),r&&r.forEach((e=>e(a))),s)return s(a)},p=setTimeout(u.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=u.bind(null,o.onerror),o.onload=u.bind(null,o.onload),l&&document.head.appendChild(o)}},n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),n.j=6349,(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var s=t.getElementsByTagName("script");if(s.length)for(var a=s.length-1;a>-1&&(!e||!/^http(s?):/.test(e));)e=s[a--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),(()=>{n.b="undefined"!=typeof document&&document.baseURI||self.location.href;var e={6349:0};n.f.j=(t,s)=>{var a=n.o(e,t)?e[t]:void 0;if(0!==a)if(a)s.push(a[2]);else{var r=new Promise(((s,r)=>a=e[t]=[s,r]));s.push(a[2]=r);var i=n.p+n.u(t),o=new Error;n.l(i,(s=>{if(n.o(e,t)&&(0!==(a=e[t])&&(e[t]=void 0),a)){var r=s&&("load"===s.type?"missing":s.type),i=s&&s.target&&s.target.src;o.message="Loading chunk "+t+" failed.\n("+r+": "+i+")",o.name="ChunkLoadError",o.type=r,o.request=i,a[1](o)}}),"chunk-"+t,t)}},n.O.j=t=>0===e[t];var t=(t,s)=>{var a,r,[i,o,l]=s,c=0;if(i.some((t=>0!==e[t]))){for(a in o)n.o(o,a)&&(n.m[a]=o[a]);if(l)var d=l(n)}for(t&&t(s);c<i.length;c++)r=i[c],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return n.O(d)},s=self.webpackChunknextcloud=self.webpackChunknextcloud||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),n.nc=void 0;var i=n.O(void 0,[4208],(()=>n(29641)));i=n.O(i)})();
//# sourceMappingURL=systemtags-admin.js.map?v=4000eefb952861929de7